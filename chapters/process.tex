\chapter{Graph Processes}

\section{Motivation}

Why do we use it to generate tests?

To a more in depth-explanation, see~\cite{Ribeiro1996, Corradini2014} 

\section{Doubly-Typed Graph Grammars}

\begin{definition}[Doubly-Typed Graph] Given a type graph $T$, a \emph{doubly-typed graph} \doublyTypedGraph{} over $T$ is a tuple \doublyTypedGraph $= \left(G^T, t^{G^T},TG^T\right)$ where $G^T$ and $TG^T$ are typed graphs over $T$ and \mbox{$t^{G^T} : G^T \rightarrow TG^T$} is a typed graph morphism in \typedGraphCategory{}. We call $TG^T$ the \emph{double-type graph} and $t^{G^T}$ the double-typing morphism.

\end{definition}

\begin{definition}[Doubly-Typed Graph Morphisms]
  Given two doubly-typed graphs $G^{TG^T}$ and $H^{TG^T}$ and a graph morphism $g^T : G^T \rightarrow H^T$, we say that $g^T$ is a \emph{$TG^T$-doubly-typed graph morphism} if the following diagram weakly commutes\tinytodo{weakly commutes?}:

\diagram{
  G\ar[rr]^{g}\ar[d]_{t^{G}}& & H\ar[d]^{t^{H}} \\
  TG\ar[rr]^{id}\ar[dr]_{type_{TG}} & &TG\ar[dl]^{type_{TG}} \\
  & T &
}
\end{definition}

Notice that the type morphisms $type_G : G \rightarrow T$ and $type_H : H \rightarrow T$ can be obtained respectively as $type_{TG} \circ t^G$ and $type_{TG} \circ t^H$.

\begin{remark} Although there are different kinds of doubly-typed graph morphisms depending on whether the doubly-type graphs and the type graphs are the different, we are here only interested in the case where the doubly-typed graphs share the same double-type and type graphs. Therefore we will call \mbox{\emph{$TG^T$-doubly-typed graph morphisms}} simply by \emph{doubly-typed graph morphisms} through the rest of this work.

\end{remark}

\begin{definition}[Doubly-Typed Graph Grammars] A \emph{doubly-typed graph grammar} is a tuple $GG = \left(TG^T, I^{TG^T},P \right)$ where $TG^T$ is the double-type graph of the grammar, $I^{TG^T}$ is a doubly-typed graph corresponding to the \emph{initial graph} of the grammar and $P$ is a set of doubly-typed graph rules. 
\end{definition}

\begin{definition}[Doubly-Typed Graph Rule] Given a double-type graph $TG^T$, a doubly-typed rule with respect to $TG^T$ is a span of morphisms \doublyTypedRule{} in \doublyTypedGraphCategory{} iff $p$ is a rule in \typedGraphCategory{} (see Definition~\ref{def:graph-rule})\tinytodo{$p$ or $p^T$?}. Also, given a doubly-typed graph rule \doublyTypedRule{} its inverse rule is defined by \inverseDoublyTypedRule{}.

  Let the typing morphisms from $L^{TG^T}$, $K^{TG^T}$ and $R^{TG^T}$ be $t^{L^T}$, $t^{K^T}$ and $t^{R^T}$, respectively. For a rule $a = p^{TG^T}$ we call:

  \begin{itemize}
    \item $L_a = L_T$, $K_a = K_R$ and $R_a = R_T$, the left, gluing and right graphs of $a$.
    \item $pre_a = t^{L^T} : L^T \rightarrow TG^T$, the \emph{pre-condition} of the $a$.
    \item $post_a = t^{R^T} : R^T \rightarrow TG^T$, the \emph{post-condition} of $a$.
    \item $r_a = r^T$, the \emph{rule pattern} of $a$.\tinytodo{Not sure if we will need the rule pattern.}
  \end{itemize}
\end{definition}

\begin{definition}[Core Graph] Given a doubly-typed graph grammar \doublyTypedGraphGrammarCore{}, we have that \coreGraph{} is a \emph{core graph} iff $\forall x \in$ \coreGraph $: \exists! y \in \parens{I^T \uplus \parens{\uplus_{ai \in P} R_{ai}}}$\tinytodo{review this} such that

  \[ x =
    \begin{cases}
      in_{GG}\parens{y} & y \in I^T\\
      post_{ai}\parens{y} & y \in R_{ai} \land y \not\in rng\parens{r_{ai}}\\
    \end{cases}
   \]\tinytodo{reformulate this entire definition}

  \begin{intuition} The idea is that each element in the \emph{Core Graph} has a unique origin either being present in the initial graph or being created by a single rule.
\end{intuition}

  Each rule in a doubly-typed graph grammar whose double-type is also a core graph is called an \emph{action}. An action $a$ \emph{creates} an element $e$ iff \tinytodo{\textbf{adapt leila's thesis to dpo}}. Similarly, an action $a$ \emph{deletes} an element $e$ iff

\end{definition}

\section{Relations within Graph Grammars typed over a Core Graph}

\tinytodo{We will probably need to start using incremental negative application conditions only~\cite{Corradini2013}}


\begin{remark}[Different Graph Transformation interpretation] When dealing action, we will use a slightly different interpretation of the graph transformations for the equivalent rules. Given an action \emph{a}, we have that:
  
\diagram{
  L\ar[d]_{pre_a}        & & K\ar[ll]_{l}\ar[rr]^{r}\ar[d]|{k} & & R\ar[d]^{post_a}\\
  C^T_{|L}\ar@{}[urr]|{\left(1\right)} & & C^T_{|K}\ar[ll]^{f}\ar[rr]_{g}             & & C^T_{|R}\ar@{}[ull]|{\left(2\right)}
}

The difference lies in the fact an action 
\end{remark}

\begin{intuition} An action $a$ is a direct cause of an action $b$ if either $a$ creates some item that is needed by $b$ or $a$ deletes an item that is forbidden by a NAC of $b$. In both cases, we have that $b$ can only happen after $a$. 
\end{intuition}

\begin{definition}[Unconditional Causal Dependency Relation] Given \doublyTypedGraphGrammarCore{} a doubly-typed graph grammar and \coreGraph{} a core graph. Let $a_1, a_2 \in P, a_1 \ne a_2$ and \mbox{$e_1, e_2 \in $ \coreGraph{},} $e_1 \ne e_2$. Then: 

  \begin{enumerate}
    \item The action $a_2$ is \emph{directly causally dependent} on $a_1$ iff $\not\exists h_{21} : L_2 \rightarrow D_1$ s.t. \mbox{$d_1 \circ h_{21} = pre_2$}.

      \diagram{
        L_1 & K_1\ar[d]\ar[l]\ar[r] & R_1\ar[dr]_{post_1} & & L_2\ar@{.>}@/_1.1pc/[dlll]|{|}_<<<<{h_{21}}\ar[dl]^{pre_2} & K_2\ar[l]\ar[r]\ar[d] & R_2\\
       & D_1\ar[rr]_{d_1} & & C^T & & D_2\ar[ll] &}
    \item The element $e_2$ is \emph{directly causally dependent} on $e_1$ iff there is an action $a_1 \in P$ such that $a_1$ deletes $e_1$ and creates $e_2$.
    \item \emph{dependency relation}\tinytodo{complete}
  \end{enumerate}

\end{definition}


\begin{intuition} An action $a$ is in weak conflict with an action $b$ if either $a$ deletes something that is needed by $b$ or creates something that is forbidden by a NAC of $b$. In both cases, we have that $b$ can not happen once $a$ has happened.
\end{intuition}


\begin{definition}[Unconditional Weak Conflict Relation] Given \doublyTypedGraphGrammarCore{} a doubly-typed graph grammar and \coreGraph{} a core graph. Let $a_1, a_2 \in P, a_1 \ne a_2$ and \mbox{$e_1, e_2 \in $ \coreGraph{},} $e_1 \ne e_2$. Then: 

  \begin{enumerate}
    \item The action $a_2$ is \emph{direct weak conflict} with $a_1$ iff $\not\exists h_{12} : L_1 \rightarrow D_2$ s.t. \mbox{$d_2 \circ h_{12} = pre_1$}.

      \diagram{
        R_1 & K_1\ar[l]\ar[r]\ar[d] & L_1\ar[dr]_{pre_1} & & L_2\ar[dl]^{pre_2}\ar@{.>}@/_1.1pc/[dlll]|{|}_<<<<{h^{21}} & K_2\ar[l]\ar[r]\ar[d] & R_2\\
       & D_1\ar[rr]_{d_1} & & C^T & & D_2\ar[ll] &}
   \item The elements $e_1$ and $e_2$ are in directly weak conflict iff \tinytodo{complete}
    \item \emph{conflict relation}\tinytodo{complete}
  \end{enumerate}
\end{definition}

\begin{definition}[Concrete Occurence Relation] The dependencies and conflicts generated without NACs, i.e. produce-use and use-delete only.
\end{definition}

The problem with conditional relations in the core graph\tinytodo{expand}

\begin{definition}[Sketch] Given \doublyTypedGraphGrammarCore{} a doubly-typed graph grammar, \coreGraph{} a core graph and $P$ a set of rules with incremental, non-trivially triggered NACs only.

Given $a_1, a_2 \in P$, when the dependency of the type delete-forbid or a conflict of the type produce-forbid are real?

Let $a_1$ delete from graph \coreGraph{} an element $x \in N($\coreGraph$) \cup E($\coreGraph$)$ that potentially triggers a NAC $N_2$ of $a_2$. There are three possible cases to look at. 
  
  First, let $x$ be related to $a_2$ by the concrete occurrence relation, i.e. \mbox{$x \leq a_2 \lor a_2 \leq x$}: if $a_2 \leq x$ then the rules are not dependent by delete-forbid, because the element that triggers $N_2$ exists only after $a_2$ was already applied. On the other hand, if $x \leq a_2$, then $x$ must exists and must be deleted before $a_2$ is applied, therefore the rules are dependent by delete-forbid.

Second, $x$ is not related to $a_2$ and also is not created by any rule in $P$, i.e., $x \in$ \coreGraph{}. Then, the rules are in delete-forbid, because $x$ existed before $a_2$, which can not be applied until $x$ is deleted.

  Third, $x$ is not related to $a_2$, but there is a third rule $a_3 \in P$ which creates it, (notice that, $a_3 < a_1$ by produce-use), and $a_3$ is not related to $a_2$ by the concrete occurrence relation. \footnote{If $a_3$ is related to $a_2$ and $a_3$ creates $x$, then $a_2$ is related to $x$, which corresponds to the first case.}
\end{definition}

\begin{definition}[Conditional Causal Dependency Relation] Given two

\diagram{
   & & & & N_2 & &\\
  L_1\ar[d] & K_1\ar[d]\ar[l]\ar[r] & R_1\ar[dr]_{post_1} & & L_2\ar[u]_n\ar@{.>}@/_1.1pc/[dlll]_<<<<{h_{21}}\ar[dl]^{pre_2} & K_2\ar[l]\ar[r]\ar[d] & R_2\\
     C^T_{|L_1} & C^T_{|K_1}\ar[rr]_{d_1}\ar[l]^{e_1} & & C^T_{|R_1L_2} & & C^T_{|K_2}\ar[ll] &}

\end{definition}

\begin{definition}[Conditional Weak Conflict Relation]
\end{definition}

\begin{definition}[Occurrence Relation]
\end{definition}

\begin{definition}[Occurrence Graph Grammars]
\end{definition}

\section{Calculating Graph Process}

\subsection{Graph Process without NACs}

\begin{definition}[Colimit construction]
\end{definition}

\subsection{Graph Process with NACs}

\begin{definition}[Incremental NACs]
\end{definition}

\begin{definition}[Colimit construction with Incremental NACs]
\end{definition}
